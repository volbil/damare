{% macro genres_select() %}
<div
    x-data="{
        available: ['Романтика', 'Драма', 'Ісекай', 'Кумедія', 'Фентезі'],
        selected: [],
        input: '',
        focused: false,
        get filtered() {
            return this.available
                .filter(g => !this.selected.includes(g))
                .filter(g => g.toLowerCase().includes(this.input.toLowerCase()));
        },
        add(tag) {
            if (!this.selected.includes(tag)) this.selected.push(tag)
            this.input = ''
        },
        remove(tag) {
            this.selected = this.selected.filter(t => t !== tag)
        }
    }"
    @click.away="focused=false"
    class="relative">

    <input type="hidden" name="genres" :value="JSON.stringify(selected)" />

    <div
        @click="focused=true"
        class="flex flex-wrap items-center gap-2 min-h-[42px] p-2.5 rounded-lg bg-[#0e1e1a]/60 border border-[#13352b]
               hover:border-green-400 focus-within:border-green-500 transition">

        <template x-for="tag in selected" :key="tag">
            <div class="px-3 py-1 rounded-md bg-[#07100d]/60 border border-[#13352b] text-sm flex items-center gap-2">
                <span x-text="tag"></span>
                <button type="button" @click="remove(tag)" class="text-gray-400 hover:text-red-400">×</button>
            </div>
        </template>

        <input
            type="text"
            x-model="input"
            @focus="focused=true"
            @keydown.backspace="if(input === '') remove(selected[selected.length-1])"
            @keydown.enter.prevent="if(filtered.length) add(filtered[0])"
            placeholder="Додати жанр..."
            class="flex-1 min-w-[100px] bg-transparent outline-none border-none p-1 text-sm text-gray-200"/>
    </div>

    <div
        x-show="focused"
        class="mt-2 p-2 rounded-lg max-h-32 overflow-y-auto bg-[#0e1e1a]/90 border border-[#13352b]
               flex flex-wrap gap-2">
        <template x-for="genre in filtered" :key="genre">
            <button
                type="button"
                @click="add(genre)"
                class="px-3 py-1 rounded bg-[#07100d]/60 border border-[#13352b] text-sm hover:bg-[#13352b]"
                x-text="genre"
            ></button>
        </template>
        <template x-if="filtered.length === 0">
            <span class="text-gray-500 text-sm">Жанр не знайдено</span>
        </template>
    </div>
</div>
{% endmacro %}